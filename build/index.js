/*! For license information please see index.js.LICENSE.txt */
!function(){"use strict";var e,o={"./src/editor.scss":function(e,o,t){t.r(o)},"./src/style.scss":function(e,o,t){t.r(o)},"./src/blocks/footnote-list.js":function(e,o,t){t.r(o);var n=t("@wordpress/element"),s=t("@wordpress/block-editor"),r=t("@wordpress/blocks"),i=t("@wordpress/data"),l=t("@wordpress/i18n");(0,r.registerBlockType)("wholesome/footnote-list",{apiVersion:2,category:"design",description:(0,l.__)("A list of this posts footnotes.","wholesome-footnote"),edit:()=>{const e=(0,s.useBlockProps)({className:"wholesome-footnote-list"});let o=(0,i.useSelect)(e=>e("core/editor").getEditedPostAttribute("meta")).wholesome_footnotes||[];return o.length?(o=o.sort((e,o)=>e.order-o.order),(0,n.createElement)("aside",e,(0,n.createElement)("h2",{id:"wholesome-footnote-list__heading",className:"screen-reader-text"},(0,l.__)("Footnotes")),(0,n.createElement)("ol",null,o.map(e=>{const o=e.footnote.match(/<.+?>/gi),t=` <a class="wholesome-footnote-list__item-back" href="#${e.uid}" aria-label="${(0,l.__)("Back to content")}" title="${(0,l.__)("Back to content")}">â†µ</a>`;let s=e.footnote+t;if(o){let n=o.at(-1);"</ul>"!==n&&"</ol>"!==n||(n=o[o.length-2]),s=e.footnote.replace(new RegExp(n+"$"),t+n)}return(0,n.createElement)("li",{className:"wholesome-footnote-list__item",dangerouslySetInnerHTML:{__html:s},id:"footnote-"+e.uid,key:e.uid})})))):(0,n.createElement)("aside",e,(0,n.createElement)("p",null,(0,l.__)("Please add a footnote.")))},icon:"editor-ol",save:()=>{},supports:{align:!0},textdomain:"wholesome-footnote",title:(0,l.__)("Footnote List","wholesome-footnote")})},"./src/components/WysiwygControl.js":function(e,o,t){t.r(o);var n=t("@wordpress/element"),s=t("@wordpress/components"),r=t("@wordpress/i18n"),i=t("@wordpress/keycodes"),l=t("@wordpress/dom-ready"),c=t.n(l);t("lodash");const{wp:a}=window;class d extends n.Component{constructor(e){super(e),this.initialize=this.initialize.bind(this),this.onSetup=this.onSetup.bind(this),this.focus=this.focus.bind(this)}componentDidMount(){const{baseURL:e,suffix:o}=window.wpEditorL10n.tinymce;window.tinymce.EditorManager.overrideDefaults({base_url:e,suffix:o}),c()(()=>this.initialize())}componentWillUnmount(){const{slug:e}=this.props;window.addEventListener("DOMContentLoaded",this.initialize),a.oldEditor.remove("editor-"+e)}componentDidUpdate(e){const{slug:o,value:t}=this.props,n=window.tinymce.get("editor-"+o);e.value!==t&&n.setContent(t||"")}initialize(){const{settings:e={plugins:"charmap,colorpicker,hr,lists,media,paste,tabfocus,textcolor,fullscreen,wordpress,wpautoresize,wpeditimage,wpemoji,wpgallery,wplink,wpdialogs,wptextpattern,wpview",external_plugins:[],classic_block_editor:!0},slug:o,toolbars:t={toolbar1:"formatselect,wp_add_media,wp_adv,bold,italic,bullist,numlist,strikethrough,link",toolbar2:"pastetext,removeformat,charmap,undo,redo,wp_help",toolbar3:"",toolbar4:""},formats:n="Paragraph=p;Heading=h2;Subheading=h3"}=this.props,s={...e,...t,block_formats:n};a.oldEditor.initialize("editor-"+o,{tinymce:{...s,inline:!0,content_css:!1,fixed_toolbar_container:"#toolbar-"+o,setup:this.onSetup}})}onSetup(e){const{onChange:o,value:t}=this.props,{ref:n}=this;let s;this.editor=e,t&&e.on("loadContent",()=>e.setContent(t)),e.on("blur",()=>(s=e.selection.getBookmark(2,!0),o(e.getContent()),e.once("focus",()=>{s&&e.selection.moveToBookmark(s)}),!1)),e.on("mousedown touchstart",()=>{s=null}),e.on("keydown",e=>{const{altKey:o}=e;o&&e.keyCode===i.F10&&e.stopPropagation()}),e.on("init",()=>{const e=this.editor.getBody();document.activeElement===e&&(e.blur(),this.editor.focus())})}focus(){this.editor&&this.editor.focus()}onToolbarKeyDown(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}render(){const{slug:e}=this.props;return(0,n.createElement)(s.BaseControl,this.props,(0,n.createElement)("div",{className:"wysiwyg-control"},(0,n.createElement)("div",{key:"toolbar",id:"toolbar-"+e,ref:e=>{this.ref=e},className:"block-library-classic__toolbar wysiwyg-control__toolbar",onClick:this.focus,"data-placeholder":(0,r.__)("Click to edit"),onKeyDown:this.onToolbarKeyDown}),(0,n.createElement)("div",{key:"editor",id:"editor-"+e,className:"wp-block-freeform block-library-rich-text__tinymce wysiwyg-control__body"})))}}o.default=d},"./src/formats/footnote.js":function(e,o,t){t.r(o);var n=t("@wordpress/element"),s=t("@wordpress/block-editor"),r=t("@wordpress/components"),i=t("@wordpress/data"),l=t("@wordpress/i18n"),c=t("@wordpress/rich-text"),a=t("./src/components/WysiwygControl.js"),d=t("./src/plugins/transformations.js");const u="wholesome/footnotes",p=(e,o)=>`<a aria-describedby="wholesome-footnote-list__heading" title="${(0,l.__)("Footnote")}" class="wholesome-footnote" id="${o}" href="#footnote-${o}">${e}<sup class="wholesome-footnote__number">0</sup></a>`;(0,c.registerFormatType)(u,{className:"wholesome-footnote",edit:e=>{var o;const{contentRef:t,onChange:f,value:m}=e,{activeFormats:w}=m,[h,b]=(0,n.useState)(!1),[g,_]=(0,n.useState)(""),v=(0,i.useSelect)(e=>e("core/editor").getEditedPostAttribute("meta")).wholesome_footnotes||[],y=()=>{const e=w.filter(e=>u===e.type);if(e.length>0){const o=e[0],{attributes:t,unregisteredAttributes:n}=o;let s=n;if(t&&t.length&&(s=t),!s)return"";if(Object.prototype.hasOwnProperty.call(s,"id")){const{id:e}=s;return e}}return""};return(0,n.createElement)(n.Fragment,null,(0,n.createElement)(s.RichTextToolbarButton,{icon:"info-outline",onClick:()=>{b(!0)},title:(0,l.__)("Footnote","wholesome-footnotes")}),h&&(0,n.createElement)(r.Modal,{className:"footnotes-popover",onRequestClose:({type:e})=>{"blur"!==e&&b(!1)},title:(0,l.__)("Footnote","wholesome-footnotes")},(0,n.createElement)(a.default,{label:(0,l.__)("Enter Footnote:","wholesome-footnotes"),slug:(null==t||null===(o=t.current)||void 0===o?void 0:o.id)+"-footnote",onChange:e=>{_(e)},onLoad:setTimeout(()=>{var e;const o=document.querySelector(`#editor-${null==t||null===(e=t.current)||void 0===e?void 0:e.id}-footnote`);o&&o.focus()},500),value:(()=>{const e=y(),o=null==v?void 0:v.filter(o=>e===o.uid);var t;return o&&o.length&&(null===(t=o[0])||void 0===t?void 0:t.footnote)||""})(),toolbars:{toolbar1:"bold,italic,bullist,numlist,link,removeformat",toolbar2:"",toolbar3:"",toolbar4:""}}),(0,n.createElement)(r.Button,{className:"button button-secondary",onClick:()=>{var e;const o=(0,c.getTextContent)(m).substring(m.start,m.end);let t=y();g||f((0,c.toggleFormat)(m,{type:u})),g&&!t&&(t=(new Date).valueOf().toString(),f((0,c.insert)(m,(0,c.create)({html:p(o,t)}))));const n=[...v],s=Object.keys(n).find(e=>n[e].uid===t)||null,r=(null===(e=n[t])||void 0===e?void 0:e.order)||0,l={uid:t,footnote:g,order:r};s?n[s]=l:n.push(l),(0,i.dispatch)("core/editor").editPost({meta:{wholesome_footnotes:n,wholesome_footnotes_updated:(new Date).valueOf().toString()}}),b(!1),_(""),(0,d.setFootnoteNumbers)()},variant:"secondary"},(0,l.__)("Save","wholesome-footnotes"))))},tagName:"a",title:(0,l.__)("Footnote","wholesome-footnotes")})},"./src/index.js":function(e,o,t){t.r(o);t("./src/editor.scss"),t("./src/style.scss"),t("./src/blocks/footnote-list.js"),t("./src/formats/footnote.js");var n=t("./src/plugins/transformations.js");(0,n.setFootnotesOnDeletion)(),(0,n.setFootnotesOnOrderChange)()},"./src/plugins/transformations.js":function(e,o,t){t.r(o),t.d(o,{setFootnoteNumbers:function(){return i},setFootnotesOnOrderChange:function(){return l},setFootnotesOnDeletion:function(){return c}});var n=t("@wordpress/blocks"),s=t("@wordpress/data"),r=t("lodash");const i=()=>{let e=1;const o=(0,s.select)("core/block-editor").getBlocks(),t=(0,s.select)("core/block-editor").getSelectedBlock(),r={},i=[],l=(0,s.select)("core/editor").getEditedPostAttribute("meta"),c=(null==l?void 0:l.wholesome_footnotes)||[],a={};o.forEach(o=>{const{content:n}=o.attributes;if(null!=n&&n.includes('class="wholesome-footnote__number"')){const s=n.match(/<sup[^<>]+"wholesome-footnote__number">[^<>]+<\/sup>\s/gi);s&&s.forEach(e=>{const s=r[o.clientId];s?s.newContent=s.newContent.replace(e,""):r[o.clientId]={...o,newContent:n.replace(e,""),isSelected:t&&t.clientId===o.clientId}});const l=n.match(/<a[\S\s]*? class="wholesome-footnote">[\S\s]*?<\/a>/gi);l&&l.forEach(s=>{const l=`<sup class="wholesome-footnote__number">${e}</sup>`,c=new RegExp('id="(.*?)"',"gi").exec(s)[1];if(i.push(c),!s.includes(l)){const i=s.match(/<sup class="wholesome-footnote__number">[\S\s]*?<\/sup>/gi),d=s.replace(i,l),u=r[o.clientId];u?u.newContent=u.newContent.replace(s,d):r[o.clientId]={...o,newContent:n.replace(s,d),isSelected:t&&t.clientId===o.clientId},a[c]=e}e++})}}),Object.values(r).forEach(e=>{const{name:o,newContent:t,isSelected:r}=e,i=(0,n.createBlock)(o,{content:t});(0,s.dispatch)("core/block-editor").replaceBlock(e.clientId,i),r&&(0,s.dispatch)("core/block-editor").selectBlock(i.clientId)});const d=[...c.filter(({uid:e})=>i.includes(e))];let u=!1;if(d.length!==c.length&&(u=!0),Object.keys(a).length>0)for(const[e,o]of Object.entries(a)){const t=Object.keys(d).find(o=>d[o].uid===e)||null;t&&(d[t]={...d[t],order:o},u=!0)}return u&&(0,s.dispatch)("core/editor").editPost({meta:{wholesome_footnotes:d,wholesome_footnotes_updated:(new Date).valueOf().toString()}}),Promise.resolve()},l=(e=[],o=[])=>{const t=(0,s.subscribe)(()=>{e.length||(e=(0,s.select)("core/block-editor").getBlockOrder());const n=(0,s.select)("core/block-editor").getBlocks(),r=(0,s.select)("core/block-editor").getBlockOrder();n&&e!==r&&o!==r&&(o=r,setTimeout(()=>{(async()=>{await i();const e=(0,s.select)("core/block-editor").getBlockOrder();l(e,e)})(),t()},500))})},c=()=>{let e=0;document.addEventListener("keydown",(0,r.debounce)(()=>{var o;e||(e=null===(o=document.querySelectorAll(".wholesome-footnote"))||void 0===o?void 0:o.length)}),500),document.addEventListener("keyup",(0,r.debounce)(()=>{var o;const t=null===(o=document.querySelectorAll(".wholesome-footnote"))||void 0===o?void 0:o.length;e>t&&(i(),e=t)}),500)}},lodash:function(e){e.exports=window.lodash},"@wordpress/block-editor":function(e){e.exports=window.wp.blockEditor},"@wordpress/blocks":function(e){e.exports=window.wp.blocks},"@wordpress/components":function(e){e.exports=window.wp.components},"@wordpress/data":function(e){e.exports=window.wp.data},"@wordpress/dom-ready":function(e){e.exports=window.wp.domReady},"@wordpress/element":function(e){e.exports=window.wp.element},"@wordpress/i18n":function(e){e.exports=window.wp.i18n},"@wordpress/keycodes":function(e){e.exports=window.wp.keycodes},"@wordpress/rich-text":function(e){e.exports=window.wp.richText}},t={};function n(e){var s=t[e];if(void 0!==s)return s.exports;var r=t[e]={exports:{}};return o[e](r,r.exports,n),r.exports}n.m=o,e=[],n.O=function(o,t,s,r){if(!t){var i=1/0;for(d=0;d<e.length;d++){t=e[d][0],s=e[d][1],r=e[d][2];for(var l=!0,c=0;c<t.length;c++)(!1&r||i>=r)&&Object.keys(n.O).every((function(e){return n.O[e](t[c])}))?t.splice(c--,1):(l=!1,r<i&&(i=r));if(l){e.splice(d--,1);var a=s();void 0!==a&&(o=a)}}return o}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[t,s,r]},n.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(o,{a:o}),o},n.d=function(e,o){for(var t in o)n.o(o,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:o[t]})},n.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e={index:0,"style-index":0};n.O.j=function(o){return 0===e[o]};var o=function(o,t){var s,r,i=t[0],l=t[1],c=t[2],a=0;if(i.some((function(o){return 0!==e[o]}))){for(s in l)n.o(l,s)&&(n.m[s]=l[s]);if(c)var d=c(n)}for(o&&o(t);a<i.length;a++)r=i[a],n.o(e,r)&&e[r]&&e[r][0](),e[i[a]]=0;return n.O(d)},t=self.webpackChunkwholesome_footnotes=self.webpackChunkwholesome_footnotes||[];t.forEach(o.bind(null,0)),t.push=o.bind(null,t.push.bind(t))}();var s=n.O(void 0,["style-index"],(function(){return n("./src/index.js")}));s=n.O(s)}();
//# sourceMappingURL=index.js.map