{"version":3,"file":"index.js","mappings":"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","sources":["webpack://wholesome-footnotes/./src/editor.scss","webpack://wholesome-footnotes/./src/components/WysiwygControl.js","webpack://wholesome-footnotes/./src/formats/footnote.js","webpack://wholesome-footnotes/./src/plugins/transformations.js","webpack://wholesome-footnotes/external window \"lodash\"","webpack://wholesome-footnotes/external window [\"wp\",\"blockEditor\"]","webpack://wholesome-footnotes/external window [\"wp\",\"blocks\"]","webpack://wholesome-footnotes/external window [\"wp\",\"components\"]","webpack://wholesome-footnotes/external window [\"wp\",\"data\"]","webpack://wholesome-footnotes/external window [\"wp\",\"domReady\"]","webpack://wholesome-footnotes/external window [\"wp\",\"element\"]","webpack://wholesome-footnotes/external window [\"wp\",\"i18n\"]","webpack://wholesome-footnotes/external window [\"wp\",\"keycodes\"]","webpack://wholesome-footnotes/external window [\"wp\",\"richText\"]","webpack://wholesome-footnotes/webpack/bootstrap","webpack://wholesome-footnotes/webpack/runtime/compat get default export","webpack://wholesome-footnotes/webpack/runtime/define property getters","webpack://wholesome-footnotes/webpack/runtime/hasOwnProperty shorthand","webpack://wholesome-footnotes/webpack/runtime/make namespace object","webpack://wholesome-footnotes/./src/index.js"],"sourcesContent":["// extracted by mini-css-extract-plugin\nexport {};","/**\n * WYSIWYG Control.\n *\n * Forked from https://github.com/TomodomoCo/wp-wysiwyg-control/.\n *\n * \"The repo is not designed to be used out of the box, but rather as a starting point for\n * your own integration. As such, you can't \"install\" it via npm or another package manager;\n * instead, you should copy the files to your project.\"\n */\n\n/**\n * WordPress dependencies\n */\nimport { BaseControl } from '@wordpress/components';\nimport { Component } from '@wordpress/element';\nimport { __, _x } from '@wordpress/i18n';\nimport { F10 } from '@wordpress/keycodes';\nimport domReady from '@wordpress/dom-ready';\n\n/**\n * External dependencies\n */\nimport { uniqueId } from 'lodash';\n\nconst { wp } = window;\n\n/**\n * Is TMCE Empty?.\n *\n * @param object editor Editor.\n * @returns bool\n */\nfunction isTmceEmpty( editor ) {\n\t// When tinyMce is empty the content seems to be:\n\t// <p><br data-mce-bogus=\"1\"></p>\n\t// avoid expensive checks for large documents\n\tconst body = editor.getBody();\n\n\tif ( body.childNodes.length > 1 ) {\n\t\treturn false;\n\t}\n\n\tif ( body.childNodes.length === 0 ) {\n\t\treturn true;\n\t}\n\n\tif ( body.childNodes[ 0 ].childNodes.length > 1 ) {\n\t\treturn false;\n\t}\n\n\treturn /^\\n?$/.test( body.innerText || body.textContent );\n}\n\nclass WysiwygControl extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\t\tthis.initialize = this.initialize.bind( this );\n\t\tthis.onSetup = this.onSetup.bind( this );\n\t\tthis.focus = this.focus.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { baseURL, suffix } = window.wpEditorL10n.tinymce;\n\n\t\twindow.tinymce.EditorManager.overrideDefaults( {\n\t\t\tbase_url: baseURL,\n\t\t\tsuffix,\n\t\t} );\n\n\t\tdomReady( () => this.initialize() );\n\t}\n\n\tcomponentWillUnmount() {\n\t\tconst { slug } = this.props;\n\n\t\twindow.addEventListener( 'DOMContentLoaded', this.initialize );\n\t\twp.oldEditor.remove( `editor-${ slug }` );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst {\n\t\t\tslug,\n\t\t\tvalue,\n\t\t} = this.props;\n\n\t\tconst editor = window.tinymce.get( `editor-${ slug }` );\n\n\t\tif ( prevProps.value !== value ) {\n\t\t\teditor.setContent( value || '' );\n\t\t}\n\t}\n\n\tinitialize() {\n\t\tconst {\n\t\t\tsettings = {\n\t\t\t\tplugins: 'charmap,colorpicker,hr,lists,media,paste,tabfocus,textcolor,fullscreen,wordpress,wpautoresize,wpeditimage,wpemoji,wpgallery,wplink,wpdialogs,wptextpattern,wpview',\n\t\t\t\texternal_plugins: [],\n\t\t\t\tclassic_block_editor: true,\n\t\t\t},\n\t\t\tslug,\n\t\t\ttoolbars = {\n\t\t\t\ttoolbar1: 'formatselect,wp_add_media,wp_adv,bold,italic,bullist,numlist,strikethrough,link',\n\t\t\t\ttoolbar2: 'pastetext,removeformat,charmap,undo,redo,wp_help',\n\t\t\t\ttoolbar3: '',\n\t\t\t\ttoolbar4: '',\n\t\t\t},\n\t\t\tformats = 'Paragraph=p;Heading=h2;Subheading=h3',\n\t\t} = this.props;\n\n\t\tconst editorSettings = {\n\t\t\t...settings,\n\t\t\t...toolbars,\n\t\t\tblock_formats: formats,\n\t\t};\n\n\t\twp.oldEditor.initialize( `editor-${ slug }`, {\n\t\t\ttinymce: {\n\t\t\t\t...editorSettings,\n\t\t\t\tinline: true,\n\t\t\t\tcontent_css: false,\n\t\t\t\tfixed_toolbar_container: `#toolbar-${ slug }`,\n\t\t\t\tsetup: this.onSetup,\n\t\t\t},\n\t\t} );\n\t}\n\n\tonSetup( editor ) {\n\t\tconst {\n\t\t\tonChange,\n\t\t\tvalue,\n\t\t} = this.props;\n\n\t\tconst { ref } = this;\n\t\tlet bookmark;\n\n\t\tthis.editor = editor;\n\n\t\tif ( value ) {\n\t\t\teditor.on( 'loadContent', () => editor.setContent( value ) );\n\t\t}\n\n\t\teditor.on( 'blur', () => {\n\t\t\tbookmark = editor.selection.getBookmark( 2, true );\n\n\t\t\tonChange( editor.getContent() );\n\n\t\t\teditor.once( 'focus', () => {\n\t\t\t\tif ( bookmark ) {\n\t\t\t\t\teditor.selection.moveToBookmark( bookmark );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\treturn false;\n\t\t} );\n\n\t\teditor.on( 'mousedown touchstart', () => {\n\t\t\tbookmark = null;\n\t\t} );\n\n\t\teditor.on( 'keydown', ( event ) => {\n\t\t\tconst { altKey } = event;\n\n\t\t\t/*\n\t\t\t * Prevent Mousetrap from kicking in: TinyMCE already uses its own\n\t\t\t * `alt+f10` shortcut to focus its toolbar.\n\t\t\t */\n\t\t\tif ( altKey && event.keyCode === F10 ) {\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t} );\n\n\t\teditor.on( 'init', () => {\n\t\t\tconst rootNode = this.editor.getBody();\n\n\t\t\t// Create the toolbar by refocussing the editor.\n\t\t\tif ( document.activeElement === rootNode ) {\n\t\t\t\trootNode.blur();\n\t\t\t\tthis.editor.focus();\n\t\t\t}\n\t\t} );\n\t}\n\n\tfocus() {\n\t\tif ( this.editor ) {\n\t\t\tthis.editor.focus();\n\t\t}\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tonToolbarKeyDown( event ) {\n\t\t// Prevent WritingFlow from kicking in and allow arrows navigation on the toolbar.\n\t\tevent.stopPropagation();\n\n\t\t// Prevent Mousetrap from moving focus to the top toolbar when pressing `alt+f10` on this block toolbar.\n\t\tevent.nativeEvent.stopImmediatePropagation();\n\t}\n\n\trender() {\n\t\tconst { slug } = this.props;\n\n\t\t// Disable reasons:\n\t\t//\n\t\t// jsx-a11y/no-static-element-interactions\n\t\t//  - the toolbar itself is non-interactive, but must capture events\n\t\t//    from the KeyboardShortcuts component to stop their propagation.\n\n\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\t\treturn (\n\t\t\t<BaseControl { ...this.props }>\n\t\t\t\t<div className=\"wysiwyg-control\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tkey=\"toolbar\"\n\t\t\t\t\t\tid={ `toolbar-${ slug }` }\n\t\t\t\t\t\tref={ ( ref ) => { this.ref = ref; } }\n\t\t\t\t\t\tclassName=\"block-library-classic__toolbar wysiwyg-control__toolbar\"\n\t\t\t\t\t\tonClick={ this.focus }\n\t\t\t\t\t\tdata-placeholder={ __( 'Click to edit' ) }\n\t\t\t\t\t\tonKeyDown={ this.onToolbarKeyDown }\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tkey=\"editor\"\n\t\t\t\t\t\tid={ `editor-${ slug }` }\n\t\t\t\t\t\tclassName=\"wp-block-freeform block-library-rich-text__tinymce wysiwyg-control__body\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</BaseControl>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n\t}\n}\n\nexport default WysiwygControl;\n","/**\n * Footnotes.\n */\n\n// Import WordPress Components.\nimport { RichTextToolbarButton, URLPopover } from '@wordpress/block-editor';\nimport { Button, Modal } from '@wordpress/components';\nimport { dispatch, useSelect } from '@wordpress/data';\nimport { useState } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { create, getTextContent, insert, registerFormatType, removeFormat, toggleFormat, useAnchorRef } from '@wordpress/rich-text';\n\nimport WysiwygControl from '../components/WysiwygControl';\nimport { setFootnoteNumbers } from '../plugins/transformations';\n\nconst name = 'wholesome/footnotes';\n\nconst FootnoteBlock = ( text, uid ) => {\n\tconst number = '0';\n\tconst matches = text.match( /<a[\\S\\s]*? class=\"wholesome-footnote\">[\\S\\s]*?<\\/a>/gi );\n\treturn `<a class=\"wholesome-footnote\" id=\"${ uid }\" href=\"#footnote-${ uid }\">${ text }<sup class=\"wholesome-footnote__number\">${ number }</sup></a>`;\n};\n\n// Create Footnotes Button with Colour Selection Popover.\nconst FootnotesButton = ( props ) => {\n\tconst { contentRef, isActive, onChange, value } = props;\n\tconst { activeFormats } = value;\n\n\t// State to show popover.\n\tconst [ showPopover, setShowPopover ] = useState( false );\n\tconst [ footnote, setFootnote ] = useState( '' );\n\n\tconst meta = useSelect( ( select ) => select('core/editor').getEditedPostAttribute('meta') );\n\tconst footnotes = meta[ 'wholesome_footnotes' ] || [];\n\n\t// console.log( footnotes );\n\n\tconst getActiveFootnote = () => {\n\t\tconst uid = getActiveFootnoteUID();\n\t\tconst selectedFootnote = footnotes?.filter( footnote => uid === footnote.uid );\t\t\n\t\tif ( selectedFootnote && selectedFootnote.length ) {\n\t\t\treturn selectedFootnote[0]?.footnote || '';\n\t\t}\n\n\t\treturn '';\n\t};\n\n\tconst getActiveFootnoteUID = () => {\n\t\tconst formats = activeFormats.filter( ( format ) => name === format.type );\n\n\t\tif ( formats.length > 0 ) {\n\t\t\tconst format = formats[ 0 ];\n\t\t\tconst { attributes, unregisteredAttributes } = format;\n\n\t\t\tlet appliedAttributes = unregisteredAttributes;\n\n\t\t\tif ( attributes && attributes.length ) {\n\t\t\t\tappliedAttributes = attributes;\n\t\t\t}\n\n\t\t\tif ( ! appliedAttributes ) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif ( Object.prototype.hasOwnProperty.call( appliedAttributes, 'id' ) ) {\n\t\t\t\tconst { id } = appliedAttributes;\n\t\t\t\treturn id;\n\t\t\t}\n\t\t}\n\t\treturn '';\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<RichTextToolbarButton\n\t\t\t\ticon=\"info-outline\"\n\t\t\t\t// key={ isActive ? 'footnote' : 'footnotes-not-active' }\n\t\t\t\t// name={ isActive ? 'footnote' : undefined }\n\t\t\t\tonClick={ () => {\n\t\t\t\t\tsetShowPopover( true );\n\t\t\t\t} }\n\t\t\t\ttitle={ __( 'Footnote', 'wholesome-footnotes' ) }\n\t\t\t/>\n\t\t\t{ showPopover && (\n\t\t\t\t<Modal\n\t\t\t\t\tclassName=\"footnotes-popover\"\n\t\t\t\t\tonRequestClose={ () => { setShowPopover( false );  } }\n\t\t\t\t\ttitle={ __( 'Footnote', 'wholesome-footnotes' ) }\n\t\t\t\t>\n\t\t\t\t\t<WysiwygControl\n\t\t\t\t\t\tlabel={ __( 'Enter Footnote:', 'wholesome-footnotes' ) }\n\t\t\t\t\t\tslug={ `${ contentRef?.current?.id }-footnote` }\n\t\t\t\t\t\tonChange={ ( footnote ) => {\n\t\t\t\t\t\t\tsetFootnote( footnote );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tonLoad={\n\t\t\t\t\t\t\tsetTimeout( () => {\n\t\t\t\t\t\t\t\tconst tinyMce = document.querySelector( `#editor-${ contentRef?.current?.id }-footnote` );\n\t\t\t\t\t\t\t\tif ( tinyMce ) {\n\t\t\t\t\t\t\t\t\ttinyMce.focus();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, 500 )\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalue={ getActiveFootnote() }\n\t\t\t\t\t\ttoolbars={ {\n\t\t\t\t\t\t\ttoolbar1: 'bold,italic,bullist,numlist,link,removeformat',\n\t\t\t\t\t\t\ttoolbar2: '',\n\t\t\t\t\t\t\ttoolbar3: '',\n\t\t\t\t\t\t\ttoolbar4: '',\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t\t<Button  \n\t\t\t\t\t\tclassName=\"button button-secondary\"\n\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\tlet text = getTextContent( value ).substring( value.start, value.end );\n\t\t\t\t\t\t\tlet uid = getActiveFootnoteUID();\n\t\t\t\t\t\t\n\t\t\t\t\t\t\tif ( ! footnote ) {\n\t\t\t\t\t\t\t\tonChange( toggleFormat( value, { type: name } ) ); // Remove Format.\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( footnote && ! uid ) {\n\t\t\t\t\t\t\t\tuid = new Date().valueOf().toString();\n\t\t\t\t\t\t\t\tonChange(\n\t\t\t\t\t\t\t\t\tinsert(\n\t\t\t\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\t\t\t\tcreate( {\n\t\t\t\t\t\t\t\t\t\t\thtml: FootnoteBlock( text, uid ),\n\t\t\t\t\t\t\t\t\t\t} ),\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst newFootnotes = [...footnotes];\n\t\t\t\t\t\t\tconst key = Object.keys( newFootnotes ).find( key => newFootnotes[ key ].uid === uid ) || 0;\n\t\t\t\t\t\t\tconst order = newFootnotes[uid]?.order || 0;\n\n\t\t\t\t\t\t\tconst note = {\n\t\t\t\t\t\t\t\tuid,\n\t\t\t\t\t\t\t\tfootnote,\n\t\t\t\t\t\t\t\torder,\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif ( key ) {\n\t\t\t\t\t\t\t\tnewFootnotes[ key ] = note;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnewFootnotes.push( note );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdispatch( 'core/editor' ).editPost( {\n\t\t\t\t\t\t\t\tmeta: {\n\t\t\t\t\t\t\t\t\twholesome_footnotes: newFootnotes,\n\t\t\t\t\t\t\t\t\twholesome_footnotes_updated: new Date().valueOf().toString(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\tsetShowPopover( false );\n\t\t\t\t\t\t\tsetFootnote( '' );\n\t\t\t\t\t\t\tsetFootnoteNumbers();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{ __( 'Save', 'wholesome-footnotes' ) }\n                    </Button>\n\t\t\t\t</Modal>\n\t\t\t)}\n\t\t</>\n\t);\n};\n\n// Register the Format.\nregisterFormatType(\n\tname, {\n\t\tclassName: 'wholesome-footnote',\n\t\tedit: FootnotesButton,\n\t\ttagName: 'a',\n\t\ttitle: __( 'Footnote', 'wholesome-footnotes' ),\n\t}\n);\n","import { createBlock } from '@wordpress/blocks';\nimport { dispatch, select, subscribe } from '@wordpress/data';\n\nexport const setFootnoteNumbers = () => {\n\tlet i = 1;\n\n\tconst blocks = select( 'core/block-editor' ).getBlocks();\n\tconst currentBlock = select( 'core/block-editor' ).getSelectedBlock();\n\tconst newBlocks = {};\n\tconst meta = select('core/editor').getEditedPostAttribute('meta');\n\tconst footnotes = meta[ 'wholesome_footnotes' ] || [];\n\tconst uidOrder = {};\n\n\tblocks.forEach( ( block ) => {\n\t\tconst { content } = block.attributes;\n\t\tif ( content.includes( 'class=\"wholesome-footnote__number\"' ) ) {\n\t\t\t// Remove orphans.\n\t\t\tconst childMatches = content.match( /<sup[^<>]+\"wholesome-footnote__number\">[^<>]+<\\/sup>\\s/gi );\n\t\t\tif ( childMatches ) {\n\t\t\t\tchildMatches.forEach( ( match ) => {\n\t\t\t\t\tconst selectedBlock = newBlocks[ block.clientId ];\n\t\t\t\t\tif ( selectedBlock ) {\n\t\t\t\t\t\tselectedBlock.newContent = selectedBlock.newContent.replace( match, '' );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewBlocks[ block.clientId ] = {\n\t\t\t\t\t\t\t...block,\n\t\t\t\t\t\t\tnewContent: content.replace( match, '' ),\n\t\t\t\t\t\t\tisSelected: currentBlock && currentBlock.clientId === block.clientId,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// Reorder numbers.\n\t\t\tconst matches = content.match( /<a[\\S\\s]*? class=\"wholesome-footnote\">[\\S\\s]*?<\\/a>/gi );\n\t\t\tif ( matches ) {\n\t\t\t\tmatches.forEach( ( match ) => {\n\t\t\t\t\tconst newNumber = `<sup class=\"wholesome-footnote__number\">${ i }</sup>`;\n\t\t\t\t\tconst regex = new RegExp( 'id=\"(.*?)\"', 'gi' );\n\t\t\t\t\tconst uid = regex.exec( match )[ 1 ];\n\t\t\t\t\tif ( ! match.includes( newNumber ) ) {\n\t\t\t\t\t\tconst originalNumber = match.match( /<sup class=\"wholesome-footnote__number\">[\\S\\s]*?<\\/sup>/gi );\n\t\t\t\t\t\tconst newMatch = match.replace( originalNumber, newNumber );\n\n\t\t\t\t\t\tconst selectedBlock = newBlocks[ block.clientId ];\n\t\t\t\t\t\tif ( selectedBlock ) {\n\t\t\t\t\t\t\tselectedBlock.newContent = selectedBlock.newContent.replace( match, newMatch );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnewBlocks[ block.clientId ] = {\n\t\t\t\t\t\t\t\t...block,\n\t\t\t\t\t\t\t\tnewContent: content.replace( match, newMatch ),\n\t\t\t\t\t\t\t\tisSelected: currentBlock && currentBlock.clientId === block.clientId,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.log( uid );\n\t\t\t\t\t\tconsole.log( i );\n\t\t\t\t\t\tuidOrder[uid] = i;\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t} );\n\n\tObject.values( newBlocks ).forEach( ( block ) => {\n\t\tconst { name, newContent, isSelected } = block;\n\t\tconst newBlock = createBlock( name, { content: newContent } );\n\t\tdispatch( 'core/block-editor' ).replaceBlock(\n\t\t\tblock.clientId,\n\t\t\tnewBlock,\n\t\t);\n\n\t\tif ( isSelected ) {\n\t\t\tdispatch( 'core/block-editor' ).selectBlock( newBlock.clientId );\n\t\t}\n\t} );\n\n\t// Reorder UIDs.\n\t// console.log( uidOrder );\n\t// console.log( Object.keys(uidOrder).length );\n\tif ( Object.keys( uidOrder ).length > 0) {\n\t\tconsole.log( 'do reorder' );\n\t}\n\n\treturn Promise.resolve();\n};\n\nconst doReorderAndResubscribe = async () => {\n\tawait setFootnoteNumbers();\n\tconst newBlockOrder = select( 'core/block-editor' ).getBlockOrder();\n\t// eslint-disable-next-line no-use-before-define\n\tsetFootnotesOnOrderChange( newBlockOrder, newBlockOrder );\n};\n\nexport const setFootnotesOnOrderChange = ( blockOrder = [], lastBlockOrder = [] ) => {\n\tconst unsubscribe = subscribe( () => {\n\t\tif ( ! blockOrder ) {\n\t\t\tblockOrder = select( 'core/block-editor' ).getBlockOrder();\n\t\t}\n\n\t\tconst blocks = select( 'core/block-editor' ).getBlocks();\n\t\tconst newBlockOrder = select( 'core/block-editor' ).getBlockOrder();\n\n\t\tif ( ! blocks || blockOrder === newBlockOrder ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( lastBlockOrder === newBlockOrder ) {\n\t\t\treturn;\n\t\t}\n\n\t\tlastBlockOrder = newBlockOrder;\n\n\t\t// Wait until Gutenberg has done the move.\n\t\tsetTimeout( () => {\n\t\t\tdoReorderAndResubscribe();\n\t\t\tunsubscribe();\n\t\t}, 500 );\n\t} );\n};\n","module.exports = window[\"lodash\"];","module.exports = window[\"wp\"][\"blockEditor\"];","module.exports = window[\"wp\"][\"blocks\"];","module.exports = window[\"wp\"][\"components\"];","module.exports = window[\"wp\"][\"data\"];","module.exports = window[\"wp\"][\"domReady\"];","module.exports = window[\"wp\"][\"element\"];","module.exports = window[\"wp\"][\"i18n\"];","module.exports = window[\"wp\"][\"keycodes\"];","module.exports = window[\"wp\"][\"richText\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import './editor.scss';\n\n// import './blocks/footnotes';\nimport './formats/footnote';\nimport { setFootnotesOnOrderChange } from './plugins/transformations';\n\n// Change footnote numbers when the block order changes.\nsetFootnotesOnOrderChange();\n"],"names":["BaseControl","Component","__","_x","F10","domReady","uniqueId","wp","window","isTmceEmpty","editor","body","getBody","childNodes","length","test","innerText","textContent","WysiwygControl","constructor","props","initialize","bind","onSetup","focus","componentDidMount","baseURL","suffix","wpEditorL10n","tinymce","EditorManager","overrideDefaults","base_url","componentWillUnmount","slug","addEventListener","oldEditor","remove","componentDidUpdate","prevProps","value","get","setContent","settings","plugins","external_plugins","classic_block_editor","toolbars","toolbar1","toolbar2","toolbar3","toolbar4","formats","editorSettings","block_formats","inline","content_css","fixed_toolbar_container","setup","onChange","ref","bookmark","on","selection","getBookmark","getContent","once","moveToBookmark","event","altKey","keyCode","stopPropagation","rootNode","document","activeElement","blur","onToolbarKeyDown","nativeEvent","stopImmediatePropagation","render","RichTextToolbarButton","URLPopover","Button","Modal","dispatch","useSelect","useState","create","getTextContent","insert","registerFormatType","removeFormat","toggleFormat","useAnchorRef","setFootnoteNumbers","name","FootnoteBlock","text","uid","number","matches","match","FootnotesButton","contentRef","isActive","activeFormats","showPopover","setShowPopover","footnote","setFootnote","meta","select","getEditedPostAttribute","footnotes","getActiveFootnote","getActiveFootnoteUID","selectedFootnote","filter","format","type","attributes","unregisteredAttributes","appliedAttributes","Object","prototype","hasOwnProperty","call","id","current","setTimeout","tinyMce","querySelector","substring","start","end","Date","valueOf","toString","html","newFootnotes","key","keys","find","order","note","push","editPost","wholesome_footnotes","wholesome_footnotes_updated","className","edit","tagName","title","createBlock","subscribe","i","blocks","getBlocks","currentBlock","getSelectedBlock","newBlocks","uidOrder","forEach","block","content","includes","childMatches","selectedBlock","clientId","newContent","replace","isSelected","newNumber","regex","RegExp","exec","originalNumber","newMatch","console","log","values","newBlock","replaceBlock","selectBlock","Promise","resolve","doReorderAndResubscribe","newBlockOrder","getBlockOrder","setFootnotesOnOrderChange","blockOrder","lastBlockOrder","unsubscribe"],"sourceRoot":""}